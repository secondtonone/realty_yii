$(document).ready(function(){function a(){var a=$.ajax({type:"POST",url:"/panel/lists",async:!1}).responseText,b=JSON.parse(a);return b}function b(){return $.ajax({type:"POST",url:"/panel/notes",async:!1}).responseText}function c(a){$(a).autocomplete({source:function(a,b){$.ajax({url:"/panel/autocomplete",dataType:"json",data:{q:"street",term:a.term,param:$("input#id_city").val()},success:function(a){b(a)}})},minLength:1,focus:function(b,c){return $(a).val(c.item.label),!1},select:function(b,c){return $(a).val(c.item.label),$("input#id_street").val(c.item.value),!1}})}function d(a){$(a).autocomplete({source:"/panel/autocomplete?q=city",minLength:1,focus:function(b,c){return $(a).val(c.item.label),!1},select:function(b,c){return $(a).val(c.item.label),$("input#id_city").val(c.item.value),!1}})}function e(){var a=b(),c=JSON.parse(a);if("0"==c.total)return!1;for(var d=0;d<c.total;d++)$.sticky(c.rows[d].text)}function f(a){var b=new ymaps.Map("yandexmap",{center:[55.753994,37.622093],zoom:25});ymaps.geocode(a,{results:1}).then(function(a){var c=a.geoObjects.get(0),d=(c.geometry.getCoordinates(),c.properties.get("boundedBy"));b.geoObjects.add(c),b.setBounds(d,{checkZoomRange:!0})})}function g(a){return $(document.body).append('<div id="dialog-message" title="Внимание!"><div style="padding: 10px;margin-top:15px;" class="ui-state-error ui-corner-all"><span class="ui-icon  ui-icon-alert" style="float:left; margin:0 7px 50px 0;"></span>'+a+"</div></div>"),$("#dialog-message").dialog({close:function(){$("#dialog-message").empty(),$("#dialog-message").remove()}}),setTimeout(function(){$("#dialog-message").empty(),$("#dialog-message").remove()},7e3),!1}e();var h=a(),i={value:h.rows.category,sopt:["eq"]},j={value:h.rows.building,sopt:["eq"]},k={value:h.rows.planning,sopt:["eq"]},l={value:h.rows.sellstatus,sopt:["eq"]},m={value:h.rows.timestatus,sopt:["eq"]},n={value:h.rows.floor,sopt:["eq"],searchhidden:!0},o={value:h.rows.renovation,sopt:["eq"],searchhidden:!0},p={value:h.rows.window,sopt:["eq"],searchhidden:!0},q={value:h.rows.counter,sopt:["eq"],searchhidden:!0};$(".preloader").hide(),$("#objects").jqGrid({url:"/panel/getobjects",datatype:"json",mtype:"POST",colNames:["#","","Собственник","Телефон","Город","Город","Улица","Улица","№ дома","Тип здания","Категория","Кол-во комнат","Планировка","Этаж","Этажность","Тип этажности","Площадь, м. кв.","Статус","Статус по времени","Цена","Цена с комиссией","ID Менеджера","Менеджер","Дата","","Ремонт","Окна","Счетчики","Комментарий"],colModel:[{name:"id_object",index:"id_object",width:45,align:"left",editable:!1,edittype:"text",search:!1},{name:"id_owner",index:"id_owner",editable:!0,edittype:"text",hidden:!0},{name:"name_owner",index:"name_owner",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:150}},{name:"number",index:"number",width:140,align:"center",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0,integer:!0},editoptions:{maxlength:11}},{name:"id_city",index:"id_city",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0}},{name:"name_city",index:"name_city",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:d}},{name:"id_street",index:"id_street",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0}},{name:"name_street",index:"name_street",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:c}},{name:"house_number",index:"house_number",width:70,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:8}},{name:"id_building",index:"id_building",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:j,stype:"select",searchoptions:j,editrules:{required:!0}},{name:"id_category",index:"id_category",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:i,stype:"select",searchoptions:i,editrules:{required:!0}},{name:"room_count",index:"room_count",width:90,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0,integer:!0},editoptions:{maxlength:2}},{name:"id_planning",index:"id_planning",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:k,stype:"select",searchoptions:k,editrules:{required:!0}},{name:"floor",index:"floor",width:70,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:2}},{name:"number_of_floor",index:"number_of_floor",width:70,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:2}},{name:"id_floor_status",index:"id_floor_status",editable:!1,hidden:!0,edittype:"select",formatter:"select",editoptions:n,stype:"select",searchoptions:n},{name:"space",index:"space",width:90,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0},editoptions:{maxlength:7}},{name:"id_sell_out_status",index:"id_sell_out_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:l,stype:"select",searchoptions:l},{name:"id_time_status",index:"id_time_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:m,stype:"select",searchoptions:m},{name:"price",index:"price",width:110,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"market_price",index:"market_price",width:110,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0,searchoptions:{sopt:["eq"],searchhidden:!0}},{name:"name",index:"name",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"date",index:"date",width:220,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"edit_enable",index:"edit_enable",editable:!0,edittype:"text",hidden:!0},{name:"id_renovation",index:"id_renovation",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:o,searchoptions:o},{name:"id_window",index:"id_window",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:p,searchoptions:p},{name:"id_counter",index:"id_counter",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:q,searchoptions:q},{name:"comment",index:"comment",edittype:"textarea",editable:!0,editrules:{edithidden:!0},hidedlg:!1,hidden:!0,searchoptions:{sopt:["bw","cn"],searchhidden:!0},editoptions:{rows:"6",cols:"25"}}],pager:"#pager",autowidth:!0,height:378,rowNum:20,rowList:[20,50,100],sortname:"id_object",sortorder:"desc",caption:'<i class="icon-table icon-object"></i>Объекты недвижимости',viewrecords:!0,subGrid:!0,multiselect:!0,editurl:"/panel/adminmodifyobjects",subGridRowExpanded:function(a,b){var c,d,e,g,h=$("#objects").jqGrid("getRowData",b),i=h.name_city,j=h.name_street,k=h.house_number;d=a+"_t",e="p_"+d,g=i+", "+j+" "+k,$("#"+a).html("<div class='subgridformobj'><table id='"+d+"' class='scroll'></table></div><div id='yandexmap'></div>"),$("#"+d).jqGrid({url:"/panel/getsubobjects?id_object="+b,datatype:"json",mtype:"GET",colNames:["Ремонт","Окна","Счетчики","Комментарий","Дата изменения цены","",""],colModel:[{name:"id_renovation",index:"id_renovation",edittype:"select",formatter:"select",editable:!0,width:100,editrules:o,editoptions:o},{name:"id_window",index:"id_window",edittype:"select",formatter:"select",editable:!0,width:100,editrules:p,editoptions:p},{name:"id_counter",index:"id_counter",edittype:"select",formatter:"select",editable:!0,width:100,editrules:q,editoptions:q},{name:"comment",index:"comment",width:450,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","cn"],searchhidden:!0},editoptions:{maxlength:300}},{name:"date_change",index:"date_change",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0},{name:"edit_enable",index:"edit_enable",editable:!0,edittype:"text",hidden:!0}],rowNum:20,sortname:"id_renovation",sortorder:"asc",editurl:"/panel/adminmodifysubobject?id_object="+b,onSelectRow:function(a){$(this).jqGrid("getRowData",a);a&&a!==c&&($("#"+d).jqGrid("restoreRow",c),$("#"+d).jqGrid("editRow",a,!0),c=a)},height:"100%"}),f(g)}}).navGrid("#pager",{edit:!0,add:!1,del:!1,search:!0},{width:380,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_id_renovation",a).hide(),$("#tr_id_window",a).hide(),$("#tr_id_counter",a).hide(),$("#tr_comment",a).hide(),$("#name_owner",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#name_street",a).attr({title:"Введите первые буквы улицы, выберите из вариантов"}),$("#house_number",a).attr({title:"Номер в формате: 34,7а,55/57"}),$("#space",a).attr({title:"Площадь в формате: 34, 34.5"}),$("#price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"}),$("#market_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите редактировать эту запись!"),!1}},{width:380,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_id_renovation",a).show(),$("#tr_id_window",a).show(),$("#tr_id_counter",a).show(),$("#tr_comment",a).show()},afterSubmit:function(a){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}},{width:380,reloadAfterSubmit:!0,zIndex:99},{width:490,reloadAfterSubmit:!0,multipleSearch:!0,zIndex:99,closeAfterSearch:!0},{width:380,reloadAfterSubmit:!0,zIndex:99}).navSeparatorAdd("#pager",{sepclass:"ui-separator",sepcontent:""}).navButtonAdd("#pager",{caption:"",buttonicon:"ui-icon-document",onClickButton:function(){$("#objects").jqGrid("excelExport",{url:"/panel/adminexport"})},position:"last",title:"Экспорт в Excel",cursor:"pointer"}).navSeparatorAdd("#pager",{sepclass:"ui-separator",sepcontent:""}),$("#objects").jqGrid("gridResize",{minWidth:1150,maxWidth:1800}),$("#pager_left table.navtable tbody tr").append('<div class="fast-edit-wrapper">Передача объектов: <input id="id_user" type="hidden"/><input id="name_user" type="text" placeholder="Кому" name="user"/><button id="hand-over" title="Передать объекты другому менеджеру">Передать</button></div>'),$("#users").jqGrid({url:"/panel/getusers",datatype:"json",mtype:"POST",colNames:["#","Логин","Пароль","Пароль","Статус","Уровень прав","Пользователь","Телефон","Активность","Время последней активности"],colModel:[{name:"id_user",index:"id_user",width:35,align:"right",editable:!1,search:!1},{name:"login",index:"login",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:15}},{name:"pass",index:"pass",width:150,align:"left",edittype:"text",editable:!1,search:!1},{name:"password",index:"password",width:150,align:"left",edittype:"text",editable:!0,search:!1,hidden:!0,editoptions:{maxlength:15}},{name:"active",index:"active",width:100,align:"left",edittype:"select",formatter:"select",search:!0,editoptions:{value:"1:Активен;2:Не активен"},editable:!0,stype:"select",searchoptions:{value:"1:Активен;2:Не активен",sopt:["eq"]}},{name:"id_right",index:"id_right",width:150,align:"left",edittype:"select",formatter:"select",search:!0,editoptions:{value:"user:Пользователь;admin:Администратор"},editable:!0,stype:"select",searchoptions:{value:"user:Пользователь;admin:Администратор",sopt:["eq"]}},{name:"name",index:"name",width:190,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{maxlength:150}},{name:"number",index:"number",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{maxlength:11}},{name:"online",index:"online",width:100,align:"center",editable:!1,search:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"time_activity",index:"time_activity",width:220,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}}],pager:"#pager2",autowidth:!0,height:328,rowNum:40,rowList:[40,60,100],sortname:"id_user",sortorder:"asc",multiselect:!0,caption:'<i class="icon-table icon-users"></i>Пользователи системы',viewrecords:!0,editurl:"/panel/adminmodifyusers",subGrid:!0,onSelectRow:function(a){var b=$("#users").jqGrid("getRowData",a),c=b.id_user,d=b.name;$("#id_user_sub").val(c),$("#name_user_sub").val(d),$("#pager_left #id_user").val(c),$("#pager_left #name_user").val(d)},ondblClickRow:function(a){var b=$("#objects").jqGrid("getGridParam","postData");b.filters='{"groupOp":"AND","rules":[{"field":"id_user","op":"eq","data":"'+a+'"}]}',$("#objects").jqGrid("setGridParam",{postData:b,search:!0}),$("#objects").trigger("reloadGrid")},subGridRowExpanded:function(a,b){var c=a+"_t",e="p_"+c;$("#"+a).html("<div class='subgridform'><table id='"+c+"' class='scroll'></table><div id='"+e+"' class='scroll'></div></div>"),$("#"+c).jqGrid({url:"/panel/getclients?id_user="+b,datatype:"json",mtype:"GET",colNames:["#","Покупатель","Телефон","ID Город","Город","Категория","Планировка","Этажность","Цена","Статус по времени","Статус","","Дата",""],colModel:[{name:"id_client",index:"id_client",width:15,align:"right",editable:!1,search:!1},{name:"name",index:"name",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0},editoptions:{maxlength:150}},{name:"number",index:"number",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0,number:!0},editoptions:{maxlength:11}},{name:"id_city",index:"id_city",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0},searchoptions:{sopt:["eq"],searchhidden:!0}},{name:"name_city",index:"name_city",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:d}},{name:"id_category",index:"id_category",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:i,stype:"select",searchoptions:i,editrules:{required:!0}},{name:"id_planning",index:"id_planning",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:k,stype:"select",searchoptions:k,editrules:{required:!0}},{name:"id_floor_status",index:"id_floor_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:n,stype:"select",searchoptions:n},{name:"cl_price",index:"price",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"id_time_status",index:"id_time_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:m,stype:"select",searchoptions:m},{name:"id_status",index:"id_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:{value:"1:Активен;2:Не активен"},stype:"select",searchoptions:{value:"1:Активен;2:Не активен",sopt:["eq"]}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0},{name:"date",index:"date",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0}},{name:"cl_edit_enable",index:"cl_edit_enable",editable:!0,edittype:"text",hidden:!0}],rowNum:30,rowList:[30,45,90],sortname:"id_status",sortorder:"asc",pager:"#"+e,viewrecords:!0,autowidth:!0,multiselect:!0,height:"100%",editurl:"/panel/adminmodifyclients"}),$("#"+c).jqGrid("navGrid","#"+e,{edit:!0,add:!1,del:!1,search:!0},{width:390,reloadAfterSubmit:!0,beforeShowForm:function(a){$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#cl_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите редактировать эту запись!"),!1}},{width:390,reloadAfterSubmit:!0,beforeShowForm:function(a){$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#cl_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите добавить эту запись!"),!1}},{width:390,reloadAfterSubmit:!0},{width:525,reloadAfterSubmit:!0,multipleSearch:!0,closeAfterSearch:!0},{width:390,reloadAfterSubmit:!0}).navSeparatorAdd("#pager2",{sepclass:"ui-separator",sepcontent:""}).navSeparatorAdd("#"+e,{sepclass:"ui-separator",sepcontent:""}),$("#"+e+"_left table.navtable tbody tr").append('<div class="fast-edit-wrapper">Передача покупателей: <input id="id_user_sub" type="hidden"/><input id="name_user_sub" type="text" placeholder="Кому" name="user"/><button id="hand-over-sub" title="Передать покупателей другому менеджеру">Передать</button></div>'),$("#name_user_sub").autocomplete({source:"/panel/autocomplete?q=user",minLength:1,focus:function(a,b){return $("#name_user_sub").val(b.item.label),!1},select:function(a,b){return $("#name_user_sub").val(b.item.label),$("#id_user_sub").val(b.item.value),!1}}),$("#hand-over-sub").click(function(){var a=$("#"+c).jqGrid("getGridParam","selarrrow"),b=$("#id_user_sub").val();if(b)if(a.length){var d=JSON.stringify(a);$.ajax({type:"POST",url:"/panel/adminmodifyusers",data:"oper=handcl&clients="+d+"&id_user="+b,success:function(a){$("#"+c).trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}})}else g("Поля не отмечены!");else g("Выберите сотрудника!")})}}).navGrid("#pager2",{edit:!0,add:!0,del:!1,search:!0},{width:350,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_password",a).show(),$("#tr_pass",a).hide(),$("#login",a).attr({title:"Логин должен содержать от 6 до 20 символов, только буквы латинского алфовита и цифры без других символов и пробелов."}),$("#password",a).attr({title:"Оставьте поле пустым, если не хотите изменить пароль, пароль должен содержать от 6 до 20 символов, только буквы латинского алфовита и цифры без других символов и пробелов. "}),$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"})},afterSubmit:function(a){if(a.responseText){if("less6"==a.responseText)return g("Логин или пароль содержит меньше 6 символов!"),!1;if("nomatch"==a.responseText)return g("Логин или пароль должен содержать только буквы латинского алфовита и цифры без других символов и пробелов!"),!1;var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите редактировать эту запись!"),!1}},{width:350,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_password",a).show(),$("#tr_pass",a).hide(),$("#login",a).attr({title:"Логин должен содержать от 6 до 20 символов, только буквы латинского алфовита и цифры без других символов и пробелов."}),$("#password",a).attr({title:"Пароль должен содержать от 6 до 20 символов, только буквы латинского алфовита и цифры без других символов и пробелов."}),$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"})},afterSubmit:function(a){if(a.responseText){if("less6"==a.responseText)return g("Логин или пароль содержит меньше 6 символов!"),!1;if("nomatch"==a.responseText)return g("Логин или пароль должен содержать только буквы латинского алфовита и цифры без других символов и пробелов!"),!1;var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Такой логин уже используется!"),!1}},{width:350,reloadAfterSubmit:!0,zIndex:99},{width:460,reloadAfterSubmit:!0,multipleSearch:!0,zIndex:99},{width:350,reloadAfterSubmit:!0,zIndex:99,closeAfterSearch:!0}).navSeparatorAdd("#pager2",{sepclass:"ui-separator",sepcontent:""}),$("#users").jqGrid("gridResize",{minWidth:1150,maxWidth:1800}),$("#pager2_left table.navtable tbody tr").append('<div class="fast-edit-wrapper">Статус: <select class="active-status"><option value="0" selected="selected">выбрать...</option><option value="1">Активен</option><option value="2">Не активен</option></select></div>'),$(".active-status").change(function(){$("option:selected",$(this)).each(function(){var a=$("#users").jqGrid("getGridParam","selarrrow"),b=$(".active-status :selected").val();if(b)if(a.length){var c=JSON.stringify(a);$.ajax({type:"POST",url:"/panel/adminmodifyusers",data:"oper=activestatus&users="+c+"&active="+b,success:function(a){$("#users").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}}),$(".active-status option").prop("selected",function(){return this.defaultSelected})}else g("Поля не отмечены!");else g("Выберите значение!")})}),$("#pager_left #name_user").autocomplete({source:"/panel/autocomplete?q=user",minLength:1,focus:function(a,b){return $("#pager_left #name_user").val(b.item.label),!1},select:function(a,b){return $("#pager_left #name_user").val(b.item.label),$("#pager_left #id_user").val(b.item.value),!1}}),$("#hand-over").click(function(){var a=$("#objects").jqGrid("getGridParam","selarrrow"),b=$("#pager_left #id_user").val();if(b)if(a.length){var c=JSON.stringify(a);$.ajax({type:"POST",url:"/panel/adminmodifyobjects",data:"oper=handobj&objects="+c+"&id_user="+b,success:function(a){$("#objects").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}})}else g("Поля не отмечены!");else g("Выберите сотрудника!")}),$(document.body).on("keyup","#login",function(){var a=$("#login").val();a.length>5&&$.ajax({type:"POST",url:"/panel/checklogin",data:"q=1&login="+a,success:function(a){a&&g(a)}})})}),$(document).ready(function(){function a(){$.ajax({type:"POST",url:"/panel/updatestatus",async:!1})}var b=window.location.pathname.toString(),c=b.split("/"),d=c[1]?c[1]:"panel";$("#"+d).addClass("active"),$(".sidebar-menu li a").click(function(){$(".sidebar-menu li a").removeClass("active"),$(this).addClass("active")}),$(".sidebar-menu").accordion({active:!1,collapsible:!0,heightStyle:"content"}),$(".sidebar-menu li a").removeClass("ui-corner-all"),$(".sidebar-menu li a").removeClass("ui-state-default"),$(".sidebar-menu li a").removeClass("ui-accordion-icons"),$(".sidebar-menu li a").removeClass("ui-state-hover"),$(".sidebar-menu li a").removeClass("ui-state-focus"),$('a[href^="#"]').on("click",function(a){a.preventDefault();var b=this.hash,c=$(b);$("html, body").stop().animate({scrollTop:c.offset().top},900,"swing",function(){window.location.hash=b})}),$(".user-list").slimScroll({height:"720px"}),a(),setInterval(a,3e5)});
$(document).ready(function(){function a(){var a=$.ajax({type:"POST",url:"/panel/lists",data:"q=1",async:!1}).responseText,b=JSON.parse(a);return b}function b(a){return $(document.body).append('<div id="dialog-message" title="Внимание!"><div style="padding: 10px;margin-top:15px;" class="ui-state-error ui-corner-all"><span class="ui-icon  ui-icon-alert" style="float:left; margin:0 7px 50px 0;"></span>'+a+"</div></div>"),$("#dialog-message").dialog({close:function(){$("#dialog-message").empty(),$("#dialog-message").remove()}}),setTimeout(function(){$("#dialog-message").empty(),$("#dialog-message").remove()},7e3),!1}function c(){return $.ajax({type:"POST",url:"/journal/getonlineusers",async:!1}).responseText}function d(){var a=c();$(".list-preloader").hide(),$(".user-list").html(a)}d(),setInterval(d,15e4);var e=a(),f={value:e.rows.type,sopt:["eq"]};$("#notifications").jqGrid({url:"/journal/getnotifications",datatype:"json",mtype:"POST",colNames:["#","Текст сообщения","Статус"],colModel:[{name:"id_notification",index:"id_notification",width:25,align:"left",editable:!1,edittype:"text",search:!1},{name:"text_notification",index:"text_notification",width:350,align:"left",edittype:"textarea",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{rows:"6",cols:"50"}},{name:"id_status",index:"id_status",width:50,align:"left",edittype:"select",formatter:"select",search:!0,editoptions:{value:"1:Активен;2:Не активен"},editable:!0,stype:"select",searchoptions:{value:"1:Активен;2:Не активен",sopt:["eq"]}}],pager:"#pager",autowidth:!0,height:278,rowNum:20,rowList:[20,50,100],sortname:"id_notification",sortorder:"asc",caption:'<i class="icon-table icon-notification"></i>Уведомления',viewrecords:!0,multiselect:!0,editurl:"/journal/adminmodifynotes",onSelectRow:function(){}}).navGrid("#pager",{edit:!0,add:!0,view:!1,del:!0,search:!0},{width:570,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#text_notification",a).attr({title:"Сообщение не должно содержать больше 300 символов."})},afterSubmit:function(a){if(a.responseText){if("bigger"==a.responseText)return b("Сообщение слишком большое!"),!1;var c='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",d=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),e=d.children("td.topinfo");return e.html(c),d.show(),setTimeout(function(){d.slideUp("slow")},3e3),[!0,"",""]}return b("Вы не можите редактировать эту запись!"),!1}},{width:570,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#text_notification",a).attr({title:"Сообщение не должно содержать больше 300 символов."})},afterSubmit:function(a){if(a.responseText){if("bigger"==a.responseText)return b("Сообщение слишком большое!"),!1;var c='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",d=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),e=d.children("td.topinfo");return e.html(c),d.show(),setTimeout(function(){d.slideUp("slow")},3e3),[!0,"",""]}return b("Вы не можите редактировать эту запись!"),!1}},{width:570,reloadAfterSubmit:!0,zIndex:99},{width:570,reloadAfterSubmit:!0,multipleSearch:!0,zIndex:99,closeAfterSearch:!0},{width:570,reloadAfterSubmit:!0,zIndex:99}).navSeparatorAdd("#pager",{sepclass:"ui-separator",sepcontent:""}),$("#pager_left table.navtable tbody tr").append('<div class="fast-edit-wrapper">Статус: <select class="active-status"><option value="0" selected="selected">выбрать...</option><option value="1">Активен</option><option value="2">Не активен</option></select></div>'),$(".active-status").change(function(){$("option:selected",$(this)).each(function(){var a=$("#notifications").jqGrid("getGridParam","selarrrow"),c=$(".active-status :selected").val();if(c)if(a.length){var d=JSON.stringify(a);$.ajax({type:"POST",url:"/journal/adminmodifynotes",data:"oper=activestatus&notifications="+d+"&id_status="+c,success:function(a){$("#notifications").trigger("reloadGrid"),a||b("Вы не можите редактировать эту запись!")}}),$(".active-status option").prop("selected",function(){return this.defaultSelected})}else b("Поля не отмечены!");else b("Выберите значение!")})}),$("#journalevent").jqGrid({url:"/journal/getevents",datatype:"json",mtype:"POST",colNames:["#","ID Пользователя","Пользователь","Действие","Время"],colModel:[{name:"id_event",index:"id_event",width:35,align:"right",editable:!1,search:!1},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0,searchoptions:{sopt:["eq"],searchhidden:!0}},{name:"name",index:"name",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:15}},{name:"id_type_event",index:"id_type_event",width:150,align:"left",edittype:"select",formatter:"select",editoptions:f,stype:"select",searchoptions:f},{name:"time_event",index:"time_event",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}}],pager:"#pager2",autowidth:!0,height:328,rowNum:60,rowList:[60,120],sortname:"id_event",sortorder:"desc",multiselect:!0,caption:'<i class="icon-table icon-archive"></i>Журнал действий',viewrecords:!0}).navGrid("#pager2",{edit:!1,add:!1,del:!1,view:!0,search:!0},{width:450,reloadAfterSubmit:!0,zIndex:99},{width:450,reloadAfterSubmit:!0,zIndex:99},{width:450,reloadAfterSubmit:!0,zIndex:99},{width:450,reloadAfterSubmit:!0,multipleSearch:!0,zIndex:99},{width:450,multipleSearch:!0,reloadAfterSubmit:!0,zIndex:99,closeAfterSearch:!0}),$(".user-list").on("click",".user",function(){var a=$(this).attr("id"),b=$("#journalevent").jqGrid("getGridParam","postData");b.filters='{"groupOp":"AND","rules":[{"field":"id_user","op":"eq","data":'+a+"}]}",$("#journalevent").jqGrid("setGridParam",{postData:b,search:!0}),$("#journalevent").trigger("reloadGrid")})}),$(document).ready(function(){function a(){$.ajax({type:"POST",url:"/panel/updatestatus",async:!1})}var b=window.location.pathname.toString(),c=b.split("/"),d=c[1]?c[1]:"panel";$("#"+d).addClass("active"),$(".sidebar-menu li a").click(function(){$(".sidebar-menu li a").removeClass("active"),$(this).addClass("active")}),$(".sidebar-menu").accordion({active:!1,collapsible:!0,heightStyle:"content"}),$(".sidebar-menu li a").removeClass("ui-corner-all"),$(".sidebar-menu li a").removeClass("ui-state-default"),$(".sidebar-menu li a").removeClass("ui-accordion-icons"),$(".sidebar-menu li a").removeClass("ui-state-hover"),$(".sidebar-menu li a").removeClass("ui-state-focus"),$('a[href^="#"]').on("click",function(a){a.preventDefault();var b=this.hash,c=$(b);$("html, body").stop().animate({scrollTop:c.offset().top},900,"swing",function(){window.location.hash=b})}),$(".user-list").slimScroll({height:"720px"}),a(),setInterval(a,3e5)});
$(document).ready(function(){function a(){var a=$.ajax({type:"POST",url:"/panel/lists",data:"q=1",async:!1}).responseText,b=JSON.parse(a);return b}function b(){return $.ajax({type:"POST",url:"/panel/notes",data:"q=1",async:!1}).responseText}function c(){var a=b(),c=JSON.parse(a);if("0"==c.total)return!1;for(var d=0;d<c.total;d++)$.sticky(c.rows[d].text)}function d(a){$(a).autocomplete({source:function(a,b){$.ajax({url:"/panel/autocomplete",dataType:"json",data:{q:"street",term:a.term,param:$("input#id_city").val()},success:function(a){b(a)}})},minLength:1,focus:function(b,c){return $(a).val(c.item.label),!1},select:function(b,c){return $(a).val(c.item.label),$("input#id_street").val(c.item.value),!1}})}function e(a){$(a).autocomplete({source:"/panel/autocomplete?q=city",minLength:1,focus:function(b,c){return $(a).val(c.item.label),!1},select:function(b,c){return $(a).val(c.item.label),$("input#id_city").val(c.item.value),!1}})}function f(a){var b=new ymaps.Map("yandexmap",{center:[55.753994,37.622093],zoom:25});ymaps.geocode(a,{results:1}).then(function(a){var c=a.geoObjects.get(0),d=(c.geometry.getCoordinates(),c.properties.get("boundedBy"));b.geoObjects.add(c),b.setBounds(d,{checkZoomRange:!0})})}function g(a){return $(document.body).append('<div id="dialog-message" title="Внимание!"><div style="padding: 10px;margin-top:15px;" class="ui-state-error ui-corner-all"><span class="ui-icon  ui-icon-alert" style="float:left; margin:0 7px 50px 0;"></span>'+a+"</div></div>"),$("#dialog-message").dialog({close:function(){$("#dialog-message").empty(),$("#dialog-message").remove()}}),setTimeout(function(){$("#dialog-message").empty(),$("#dialog-message").remove()},7e3),!1}$(document.body).on("keyup","#floor",function(){if(!$("#id_owner").val()){var a=$("#number").val(),b=$("#id_street").val(),c=$("#house_number").val(),d=$("#id_category :selected").val(),e=$("#room_count").val(),f=$("#floor").val(),h=$("#id_planning :selected").val();$.ajax({type:"POST",url:"/panel/checkobject",data:"number="+a+"&id_street="+b+"&house_number="+c+"&id_category="+d+"&room_count="+e+"&id_planning="+h+"&floor="+f,success:function(a){a&&g(a)}})}}),c();var h=a(),i={value:h.rows.category,sopt:["eq"]},j={value:h.rows.building,sopt:["eq"]},k={value:h.rows.planning,sopt:["eq"]},l={value:h.rows.sellstatus,sopt:["eq"]},m={value:h.rows.timestatus,sopt:["eq"]},n=({value:h.rows.district,sopt:["eq"]},{value:h.rows.floor,sopt:["eq"],searchhidden:!0}),o={value:h.rows.renovation,sopt:["eq"],searchhidden:!0},p={value:h.rows.window,sopt:["eq"],searchhidden:!0},q={value:h.rows.counter,sopt:["eq"],searchhidden:!0};$(".preloader").hide(),$("#objects").jqGrid({url:"/panel/getobjects",datatype:"json",mtype:"POST",colNames:["#","","Собственник","Телефон","ID Город","Город","Улица","Улица","№ дома","Тип здания","Категория","Кол-во комнат","Планировка","Этаж","Этажность","Тип этажности","Площадь, м. кв.","Статус","Статус по времени","Цена","Цена с комиссией","","Менеджер","Дата","","Ремонт","Окна","Счетчики","Комментарий"],colModel:[{name:"id_object",index:"id_object",width:45,align:"left",editable:!1,edittype:"text",search:!1},{name:"id_owner",index:"id_owner",editable:!0,edittype:"text",hidden:!0},{name:"name_owner",index:"name_owner",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:150}},{name:"number",index:"number",width:140,align:"center",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0,integer:!0},editoptions:{maxlength:11}},{name:"id_city",index:"id_city",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0},searchoptions:{sopt:["eq"],searchhidden:!0}},{name:"name_city",index:"name_city",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:e}},{name:"id_street",index:"id_street",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0}},{name:"name_street",index:"name_street",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:d}},{name:"house_number",index:"house_number",width:90,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editrules:{required:!0},editoptions:{maxlength:8}},{name:"id_building",index:"id_building",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:j,stype:"select",searchoptions:j,editrules:{required:!0}},{name:"id_category",index:"id_category",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:i,stype:"select",searchoptions:i,editrules:{required:!0}},{name:"room_count",index:"room_count",width:90,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0,integer:!0},editoptions:{maxlength:2}},{name:"id_planning",index:"id_planning",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:k,stype:"select",searchoptions:k,editrules:{required:!0}},{name:"floor",index:"floor",width:70,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:2}},{name:"number_of_floor",index:"number_of_floor",width:70,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:2}},{name:"id_floor_status",index:"id_floor_status",editable:!1,hidden:!0,edittype:"select",formatter:"select",editoptions:n,stype:"select",searchoptions:n},{name:"space",index:"space",width:90,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0},editoptions:{maxlength:7}},{name:"id_sell_out_status",index:"id_sell_out_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:l,stype:"select",searchoptions:l},{name:"id_time_status",index:"id_time_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:m,stype:"select",searchoptions:m},{name:"price",index:"price",width:110,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"market_price",index:"market_price",width:110,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0},{name:"name",index:"name",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"date",index:"date",width:220,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"edit_enable",index:"edit_enable",editable:!0,edittype:"text",hidden:!0},{name:"id_renovation",index:"id_renovation",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:o,searchoptions:o},{name:"id_window",index:"id_window",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:p,searchoptions:p},{name:"id_counter",index:"id_counter",edittype:"select",formatter:"select",editable:!0,editrules:{edithidden:!0},hidedlg:!1,stype:"select",hidden:!0,editoptions:q,searchoptions:q},{name:"comment",index:"comment",edittype:"textarea",editable:!0,editrules:{edithidden:!0},hidedlg:!1,hidden:!0,searchoptions:{sopt:["bw","cn"],searchhidden:!0},editoptions:{rows:"6",cols:"25"}}],pager:"#pager",autowidth:!0,height:378,rowNum:20,rowList:[20,50,100],sortname:"id_object",sortorder:"asc",caption:'<i class="icon-table icon-object"></i>Объекты недвижимости',viewrecords:!0,subGrid:!0,multiselect:!0,toolbar:[!0,"top"],editurl:"/panel/usermodifyobjects",rowattr:function(a){return"0"==a.edit_enable?{"class":"alt-row-class"}:void 0},beforeSelectRow:function(a){var b=$("#objects").jqGrid("getRowData",a);return"1"==b.edit_enable?($("#edit_objects").removeClass("ui-state-disabled"),$(".select-wrap").css({display:"inline-block"})):($("#edit_objects").addClass("ui-state-disabled"),$(".select-wrap").css({display:"none"})),!0},ondblClickRow:function(a){var b,c,d=$("#clients").jqGrid("getGridParam","postData"),e=$("#objects").jqGrid("getRowData",a),f=e.id_category,g=e.id_planning,h=e.id_floor_status,i=e.id_city,j=e.market_price,k=['{"field":"id_category","op":"eq","data":"'+f+'"},','{"field":"id_planning","op":"eq","data":"'+g+'"},','{"field":"id_floor_status","op":"eq","data":"'+h+'"},','{"field":"id_city","op":"eq","data":"'+i+'"},'];b=parseInt(j)-1e5,c=parseInt(j)+1e5,"13"==f&&(k[0]=""),"7"==g&&(k[1]=""),"4"==h&&(k[2]='{"field":"id_floor_status","op":"ne","data":"1"},'),"5"==h&&(k[2]='{"field":"id_floor_status","op":"ne","data":"2"},'),"6"==h&&(k[2]=""),d.filters='{"groupOp":"AND","rules":['+k[0]+k[1]+k[2]+k[3]+'{"field":"price","op":"ge","data":"'+b+'"},{"field":"price","op":"le","data":"'+c+'"}]}',$("#clients").jqGrid("setGridParam",{postData:d,search:!0}),$("#clients").trigger("reloadGrid")},subGridRowExpanded:function(a,b){var c,d,e,g,h=$("#objects").jqGrid("getRowData",b),i=h.name_city,j=h.name_street,k=h.house_number;d=a+"_t",e="p_"+d,g=i+", "+j+" "+k,$("#"+a).html("<div class='subgridformobj'><table id='"+d+"' class='scroll'></table></div><div id='yandexmap'></div>"),f(g),$("#"+d).jqGrid({url:"/panel/getsubobjects?id_object="+b,datatype:"json",mtype:"GET",colNames:["Ремонт","Окна","Счетчики","Комментарий","Дата изменения цены","",""],colModel:[{name:"id_renovation",index:"id_renovation",edittype:"select",formatter:"select",editable:!0,width:100,editrules:o,editoptions:o},{name:"id_window",index:"id_window",edittype:"select",formatter:"select",editable:!0,width:100,editrules:p,editoptions:p},{name:"id_counter",index:"id_counter",edittype:"select",formatter:"select",editable:!0,width:100,editrules:q,editoptions:q},{name:"comment",index:"comment",width:450,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","cn"],searchhidden:!0},editoptions:{maxlength:300}},{name:"date_change",index:"date_change",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0},{name:"edit_enable",index:"edit_enable",editable:!0,edittype:"text",hidden:!0}],rowNum:20,sortname:"id_renovation",sortorder:"asc",editurl:"/panel/usermodifysubobject?id_object="+b,onSelectRow:function(a){var b=$(this).jqGrid("getRowData",a);a&&a!==c&&($("#"+d).jqGrid("restoreRow",c),"1"==b.edit_enable&&($("#"+d).jqGrid("editRow",a,!0),c=a))},height:"100%",rowattr:function(a){return"0"==a.edit_enable?{"class":"alt-row-class"}:void 0}})}}).navGrid("#pager",{edit:!0,add:!0,del:!1,search:!0},{width:380,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_id_renovation",a).hide(),$("#tr_id_window",a).hide(),$("#tr_id_counter",a).hide(),$("#tr_comment",a).hide(),$("#name_owner",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#name_street",a).attr({title:"Введите первые буквы улицы, выберите из вариантов"}),$("#house_number",a).attr({title:"Номер в формате: 34,7а,55/57"}),$("#space",a).attr({title:"Площадь в формате: 34, 34.5"}),$("#price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"}),$("#market_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите редактировать эту запись!"),!1}},{width:380,reloadAfterSubmit:!0,zIndex:99,beforeShowForm:function(a){$("#tr_id_renovation",a).show(),$("#tr_id_window",a).show(),$("#tr_id_counter",a).show(),$("#tr_comment",a).show(),$("#name_owner",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#name_street",a).attr({title:"Введите первые буквы улицы, выберите из вариантов"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#house_number",a).attr({title:"Номер в формате: 34,7а,55/57"}),$("#space",a).attr({title:"Площадь в формате: 34, 34.5"}),$("#price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"}),$("#market_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"}),$("#comment",a).attr({title:"Комментарий не более 300 символов"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите добавить эту запись!"),!1}},{width:380,reloadAfterSubmit:!0,zIndex:99},{width:490,reloadAfterSubmit:!0,multipleSearch:!0,zIndex:99,closeAfterSearch:!0},{width:380,reloadAfterSubmit:!0,zIndex:99}).navSeparatorAdd("#pager",{sepclass:"ui-separator",sepcontent:""}).navButtonAdd("#pager",{caption:"",buttonicon:"ui-icon-document",onClickButton:function(){$("#objects").jqGrid("excelExport",{url:"/panel/userexport?q=objects"})},position:"last",title:"Экспорт в Excel",cursor:"pointer"}).navSeparatorAdd("#pager",{sepclass:"ui-separator",sepcontent:""}),$("#edit_objects").addClass("ui-state-disabled"),$("#objects").jqGrid("gridResize",{minWidth:1150,maxWidth:1800}),$("#pager_left table.navtable tbody tr").append('<div class="select-wrap">Статус: <select class="sell-out-status"><option value="0" selected="selected">выбрать...</option><option value="1">В продаже</option><option value="2">Продано</option><option value="3">Снять</option><option value="4">Времено снять</option></select></div>'),$("#pager_left table.navtable tbody tr").append('  <div class="select-wrap">Статус по времени: <select class="time-status"><option value="0" selected="selected">выбрать...</option><option value="2">срочно</option><option value="1">не срочно</option></select></div>'),$("#t_objects").append("Фильтры: <button class='button-status' title='Показать объекты для срочной реализации'>Срочные</button>"),$(".button-status").click(function(){var a=$("#objects").jqGrid("getGridParam","postData");a.filters='{"groupOp":"AND","rules":[{"field":"id_time_status","op":"eq","data":"2"}]}',$("#objects").jqGrid("setGridParam",{postData:a,search:!0}),$("#objects").trigger("reloadGrid")}),$(".sell-out-status").change(function(){$("option:selected",$(this)).each(function(){var a,b,c,d=$("#objects").jqGrid("getGridParam","selarrrow"),e=$(".sell-out-status :selected").val(),f={};if(e)if(d.length){for(var h=0;h<d.length;h++)a=d[h],b=$("#objects").jqGrid("getRowData",a),c=b.id_user,f[a]=c;var i=JSON.stringify(f);$.ajax({type:"POST",url:"/panel/usermodifyobjects",data:"oper=selloutstatus&match="+i+"&id_status="+e,success:function(a){$("#objects").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}}),$(".sell-out-status option").prop("selected",function(){return this.defaultSelected})}else g("Поля не отмечены!");else g("Выберите значение!")})}),$(".time-status").change(function(){$("option:selected",$(this)).each(function(){var a,b,c,d=$("#objects").jqGrid("getGridParam","selarrrow"),e=$(".time-status :selected").val(),f={};if(e)if(d.length){for(var h=0;h<d.length;h++)a=d[h],b=$("#objects").jqGrid("getRowData",a),c=b.id_user,f[a]=c;var i=JSON.stringify(f);$.ajax({type:"POST",url:"/panel/usermodifyobjects",data:"oper=timestatus&match="+i+"&id_status="+e,success:function(a){$("#objects").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}}),$(".time-status option").prop("selected",function(){return this.defaultSelected})}else g("Поля не отмечены!");else g("Выберите значение!")})}),$(document.body).on("change","#id_planning",function(){if(!$("#cl_price").val()){var a=$("#number").val(),b=$("#id_category :selected").val(),c=$("#id_planning :selected").val();$.ajax({type:"POST",url:"/panel/checkclient",data:"number="+a+"&id_category="+b+"&id_planning="+c,success:function(a){a&&g(a)}})}}),$("#clients").jqGrid({url:"/panel/getclients",datatype:"json",mtype:"POST",colNames:["#","Покупатель","Телефон","ID Город","Город","Категория","Планировка","Этажность","Цена","Статус по времени","Статус","","Менеджер","Дата",""],colModel:[{name:"id_client",index:"id_client",width:45,align:"right",editable:!1,search:!1},{name:"name",index:"clname",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0},editoptions:{maxlength:150}},{name:"number",index:"number",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0},editrules:{required:!0,number:!0},editoptions:{maxlength:11}},{name:"id_city",index:"id_city",editable:!0,edittype:"text",hidden:!0,editrules:{required:!0},searchoptions:{sopt:["eq"],searchhidden:!0}},{name:"name_city",index:"name_city",width:200,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["bw","eq","ne","cn"]},editoptions:{size:20,dataInit:e}},{name:"id_category",index:"id_category",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:i,stype:"select",searchoptions:i,editrules:{required:!0}},{name:"id_planning",index:"id_planning",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:k,stype:"select",searchoptions:k,editrules:{required:!0}},{name:"id_floor_status",index:"id_floor_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:n,stype:"select",searchoptions:n},{name:"cl_price",index:"price",width:150,align:"left",edittype:"text",editable:!0,searchoptions:{sopt:["le","lt","gt","ge","bw","eq","ne"]},editrules:{required:!0,number:!0},editoptions:{maxlength:10}},{name:"id_time_status",index:"id_time_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:m,stype:"select",searchoptions:m},{name:"id_status",index:"id_status",editable:!0,width:150,align:"left",edittype:"select",formatter:"select",editoptions:{value:"1:Активен;2:Не активен"},stype:"select",searchoptions:{value:"1:Активен;2:Не активен",sopt:["eq"]}},{name:"id_user",index:"id_user",editable:!0,edittype:"text",hidden:!0},{name:"name",index:"name",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"]}},{name:"date",index:"date",width:150,align:"left",edittype:"text",editable:!1,searchoptions:{sopt:["bw","eq","ne","cn"],clearSearch:!0}},{name:"cl_edit_enable",index:"cl_edit_enable",editable:!0,edittype:"text",hidden:!0}],pager:"#pager2",autowidth:!0,height:278,rowNum:15,rowList:[15,45,90],sortname:"id_client",sortorder:"desc",caption:'<i class="icon-table icon-client"></i>Покупатели',toolbar:[!0,"top"],viewrecords:!0,multiselect:!0,rowattr:function(a){return"0"==a.cl_edit_enable?{"class":"alt-row-class"}:void 0},beforeSelectRow:function(a){var b=$("#clients").jqGrid("getRowData",a);return"1"==b.cl_edit_enable?($("#edit_clients").removeClass("ui-state-disabled"),$(".cl-select-wrap").css({display:"inline-block"})):($("#edit_clients").addClass("ui-state-disabled"),$(".cl-select-wrap").css({display:"none"})),!0},ondblClickRow:function(a){var b,c,d=$("#objects").jqGrid("getGridParam","postData"),e=$("#clients").jqGrid("getRowData",a),f=e.id_category,g=e.id_planning,h=e.id_floor_status,i=e.id_city,j=e.cl_price,k=['{"field":"id_category","op":"eq","data":"'+f+'"},','{"field":"id_planning","op":"eq","data":"'+g+'"},','{"field":"id_floor_status","op":"eq","data":"'+h+'"},','{"field":"id_city","op":"eq","data":"'+i+'"},'];b=parseInt(j)-1e5,c=parseInt(j)+1e5,"13"==f&&(k[0]=""),"7"==g&&(k[1]=""),"4"==h&&(k[2]='{"field":"id_floor_status","op":"ne","data":"1"},'),"5"==h&&(k[2]='{"field":"id_floor_status","op":"ne","data":"2"},'),"6"==h&&(k[2]=""),d.filters='{"groupOp":"AND","rules":['+k[0]+k[1]+k[2]+k[3]+'{"field":"market_price","op":"ge","data":"'+b+'"},{"field":"market_price","op":"le","data":"'+c+'"}]}',$("#objects").jqGrid("setGridParam",{postData:d,search:!0}),$("#objects").trigger("reloadGrid")},editurl:"/panel/usermodifyclients"}).navGrid("#pager2",{view:!1,del:!1,add:!0,edit:!0,search:!0},{width:390,reloadAfterSubmit:!0,beforeShowForm:function(a){$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#cl_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите редактировать эту запись!"),!1}},{width:390,reloadAfterSubmit:!0,beforeShowForm:function(a){$("#name",a).attr({title:"ФИО в формате: Иванов Иван Иванович"}),$("#name_city",a).attr({title:"Введите первые буквы города, выберите из вариантов"}),$("#number",a).attr({title:"Номер в формате: 89011123456 (только цифры)"}),$("#cl_price",a).attr({title:"Цена в формате: 1000000 (только цифры без сокращений)"})},afterSubmit:function(a){if(a.responseText){var b='<div class="ui-state-highlight ui-corner-all"><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;"></span>'+a.responseText+"</div>",c=$("#TblGrid_"+$.jgrid.jqID(this.id)+">tbody>tr.tinfo"),d=c.children("td.topinfo");return d.html(b),c.show(),setTimeout(function(){c.slideUp("slow")},3e3),[!0,"",""]}return g("Вы не можите добавить эту запись!"),!1}},{width:390,reloadAfterSubmit:!0},{width:525,reloadAfterSubmit:!0,multipleSearch:!0,closeAfterSearch:!0},{width:390,reloadAfterSubmit:!0}).navSeparatorAdd("#pager2",{sepclass:"ui-separator",sepcontent:""}).navButtonAdd("#pager2",{caption:"",buttonicon:"ui-icon-document",onClickButton:function(){$("#clients").jqGrid("excelExport",{url:"/panel/userexport?q=clients"})},position:"last",title:"Экспорт в Excel",cursor:"pointer"}).navSeparatorAdd("#pager2",{sepclass:"ui-separator",sepcontent:""}),$("#edit_clients").addClass("ui-state-disabled"),$("#clients").jqGrid("gridResize",{minWidth:1150,maxWidth:1800}),$("#pager2_left table.navtable tbody tr").append('<div class="cl-select-wrap">Статус: <select class="active-status"><option value="0" selected="selected">выбрать...</option><option value="1">Активен</option><option value="2">Не активен</option></select></div>'),$("#pager2_left table.navtable tbody tr").append('  <div class="cl-select-wrap">Статус по времени: <select class="cl-time-status"><option value="0" selected="selected">выбрать...</option><option value="2">срочно</option><option value="1">не срочно</option></select></div>'),$("#t_clients").append("Фильтры: <button class='cl-button-status' title='Показать клиентов для срочной работы'>Срочные</button>"),$(".cl-button-status").click(function(){var a=$("#clients").jqGrid("getGridParam","postData");a.filters='{"groupOp":"AND","rules":[{"field":"id_time_status","op":"eq","data":"2"}]}',$("#clients").jqGrid("setGridParam",{postData:a,search:!0}),$("#clients").trigger("reloadGrid")}),$(".active-status").change(function(){$("option:selected",$(this)).each(function(){var a,b,c,d=$("#clients").jqGrid("getGridParam","selarrrow"),e=$(".active-status :selected").val(),f={};if(e)if(d.length){for(var h=0;h<d.length;h++)a=d[h],b=$("#clients").jqGrid("getRowData",a),c=b.id_user,f[a]=c;var i=JSON.stringify(f);$.ajax({type:"POST",url:"/panel/usermodifyclients",data:"oper=activestatus&match="+i+"&id_status="+e,success:function(a){$("#clients").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}}),$(".active-status option").prop("selected",function(){return this.defaultSelected})}else g("Поля не отмечены!");else g("Выберите значение!")})}),$(".cl-time-status").change(function(){$("option:selected",$(this)).each(function(){var a,b,c,d=$("#clients").jqGrid("getGridParam","selarrrow"),e=$(".cl-time-status :selected").val(),f={};if(e)if(d.length){for(var h=0;h<d.length;h++)a=d[h],b=$("#clients").jqGrid("getRowData",a),c=b.id_user,f[a]=c;var i=JSON.stringify(f);$.ajax({type:"POST",url:"/panel/usermodifyclients",data:"oper=timestatus&match="+i+"&id_status="+e,success:function(a){$("#clients").trigger("reloadGrid"),a||g("Вы не можите редактировать эту запись!")}}),$(".cl-time-status option").prop("selected",function(){return this.defaultSelected})}else g("Поля не отмечены!");else g("Выберите значение!")})})}),$(document).ready(function(){function a(){$.ajax({type:"POST",url:"/panel/updatestatus",async:!1})}var b=window.location.pathname.toString(),c=b.split("/"),d=c[1]?c[1]:"panel";$("#"+d).addClass("active"),$(".sidebar-menu li a").click(function(){$(".sidebar-menu li a").removeClass("active"),$(this).addClass("active")}),$(".sidebar-menu").accordion({active:!1,collapsible:!0,heightStyle:"content"}),$(".sidebar-menu li a").removeClass("ui-corner-all"),$(".sidebar-menu li a").removeClass("ui-state-default"),$(".sidebar-menu li a").removeClass("ui-accordion-icons"),$(".sidebar-menu li a").removeClass("ui-state-hover"),$(".sidebar-menu li a").removeClass("ui-state-focus"),$('a[href^="#"]').on("click",function(a){a.preventDefault();var b=this.hash,c=$(b);$("html, body").stop().animate({scrollTop:c.offset().top},900,"swing",function(){window.location.hash=b})}),$(".user-list").slimScroll({height:"720px"}),a(),setInterval(a,3e5)});